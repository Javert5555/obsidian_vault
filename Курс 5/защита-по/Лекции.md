В рамках основного лекционного курса изучаются две основные темы: «Анализ программных реализаций» и «Программные закладки». В ходе практических занятий могут быть рассмотрены (на усмотрение преподавателя, ведущего практические занятия по данному курсу) дополнительные темы, например «Защита от копирования» или «Анализ остаточной информации». Вносить в основной лекционный курс эти и другие узкоспециализированные аспекты защиты программ и данных представляется нецелесообразным. Детальное изучение средств и методов анализа программных реализаций целесообразно по следующим причинам. Навыки анализа программных реализаций требуются выпускнику при решении целого ряда практических задач, например:
- экспертиза качества реализации программных и программно-аппаратных средств обеспечения информационной безопасности;
- исследование программного обеспечения на предмет наличия недокументированных возможностей;
- выявление уязвимостей программного обеспечения;
- выявление вредоносного программного обеспечения, оценка опасности обнаруженных вредоносных программ, планирование работ по локализации последствий и пресечению обнаруженной атаки.

Кроме того, владение навыками анализа программных реализаций упрощает отладку собственноручно написанного программного кода и тем самым повышает производительность труда программиста. Программные закладки (в особенности компьютерные вирусы) на сегодняшний день являются одной из наиболее масштабных и опасных угроз информационной безопасности. Трудно представить себе объект информатизации, для которого данная угроза была бы неактуальна. К сожалению, работы по выявлению и уничтожению программных закладок, как правило, сводятся к бездумному применению программных и программно-аппаратных антивирусных комплексов, при этом планирование мероприятий по обеспечению защиты отданной угрозы либо осуществляется чисто формально, либо не осуществляется вообще. В значительной степени это обусловлено недостатком специалистов, обладающих квалификацией, позволяющей эффективно планировать и поддерживать адекватную политику антивирусной защиты компьютеров и компьютерных сетей. Настоящее учебное пособие призвано устранить данный недостаток хотя бы частично.

## 1. Теоретические основы анализа программ

Актуальность задачи анализа программных реализаций алгоритмов защиты обусловливается следующими факторами.
1. Компьютеризация всех областей национальной экономики России. В настоящее время компьютерные технологии активно применяются практически во всех новых областях нашей жизни. Автоматизированные средства обработки информации используются как в высших эшелонах государственной власти и управления, так и в многочисленных предприятиях и организациях, банках и т. п. Практически каждая организациям имеет у себя конфиденциальную информацию, которую надо защищать.
2. Многообразие программных средств обработки информации и используемых в них средств защиты. Средства защиты встраиваются во многие программные продукты самого различного назначения (операционные системы, системы управления базы данных, системы электронного документооборота, разнообразные утилиты и т. п.). При этом подробные технические описания, а также данные независмых экспертиз качества используемой системы защиты далеко не всегда доступны пользователю. В этих условия пользователю информационной системы жизненно важно знать, насколько надежна применяемая им защита.
3. Большой разброс в уровне подготовленности разработчиков. Разработкой систем защиты информации занимаются различные люди и организации, порой разительно отличающиеся по своему научно-техническому потенциалу, уровню подготовки, техническим возможностям. К их числу зачастую относятся любители, т. е. лица, не являющиеся специалистами в области защиты информации. Нельзя исключить с их стороны ошибки при выборе алгоритмов защиты и просто программистские ошибки в процессе разработки программного обеспечения. Хотя сегодня откровенно слабые решения в области защиты информации встречаются гораздо реже, чем 10 — 15 лет назад, они все же встречаются. Одним из последних примеров такого рода, получивших широкую огласку, является система фильтрации информации порнографического характера на «Школьном портале», которая считала поисковый запрос «мокрый снег» непристойным, а целый ряд явно порнографических запросов — вполне допустимыми для школьника.
4. Широкое распространение программных средств зарубежного производства. Среди всех программных средств, применяемых в России в настоящее время, львиную долю составляют программные средства зарубежного производства. В ряде стран, например в США и Франции, имеются ограничения на экспорт стойких систем защиты информации. Бесспорно высокий уровень квалификации подобных разработчиков, удобство эксплуатации информационной системы, сконструированной ведущими зарубежными фирмами, еще не дает гарантии, что информационная система обладает надежной защитой. Кроме того, для программных средств, применяемых в критически важных сегментах информационной инфраструктуры Российской Федерации, весьма важной является задача заблаговременного выявления в используемых программных средствах недокументированных возможностей, которые в случае начала информационной войны могут послужить информационным оружием.
5. Регулярное появление новых версий программных продуктов, которые могут отличаться и средствами защиты. Современные средства обработки информации — чрезвычайно быстро развивающаяся сфера деятельности человека, поэтому проверка надежности средств защиты информационной системы не может рассматриваться как кратковременный эпизод в жизни организации. К этому вопросу приходится возвращаться неоднократно, в связи с чем стоит задача разработки эффективных средств анализа, максимальной автоматизации наиболее трудоемких его этапов.
6. Следует отметить, что описываемую в данной главе методику анализа программ можно применять не только для защиты информации, но и для «нападения» — получения незаконных копий программ, встраивания в программы закладок и вирусов и т. д. Поскольку автор не рассматривает данную книгу как пособие для начинающего хакера, вопросы, связанные с применением методов изучения программ для выполнения подобных незаконных действий, рассматриваться не будут.

Работа по анализу программы включает в себя три основных этапа.
1. Подготовительный этап. На данном этапе аналитик проводит первичное знакомство с анализируемой программой, изучает доступную документацию, планирует дальнейшие исследования, подбирает коллектив и организует его работу. Важность этого этапа нельзя недооценивать. Эффективность дальнейшей работы очень сильно зависит от того, насколько полная информация об анализируемой программе была получена на первом этапе. Если аналитик сумел получить исходный текст анализируемой программы, задача анализа программы в большинстве случаев решается тривиально. Наличие у аналитика отладочной информации об анализируемой программе также существенно упрощает дальнейшую работу.
2. Восстановление алгоритмов функционирования программы. На данном этапе, собственно, и производится изучение программы. Методам, применяемым на этом этапе, посвящена большая часть данной главы.
3. Проверка полученных результатов. На данном этапе аналитик проверяет результаты проведенных исследований. Обычно эта проверка заключается в написании тестовой программы, которая реализует восстановленные алгоритмы анализируемой программы. Если поведение тестовой программы не отличается от поведения анализируемой в отношении анализируемых алгоритмов, задачу можно считать решенной. Если же поведение тестовой программы отличается от поведения анализируемой, это означает, что в анализе программы допущены ошибки, которые необходимо устранить. Как правило, правильно восстановить анализируемые алгоритмы с первого раза не удается.

В настоящее время сформировались следующие подходы к восстановлению алгоритмов, реализуемых программой:
- метод экспериментов;
- статический метод;
- динамический метод.

В методе экспериментов программа рассматривается как «черный ящик», осуществляющий определенные преобразования в зависимости от поступающего на него входа. Аналитик проводит многократные эксперименты, манипулируя входными данными, анализируя и сравнивая получаемые результаты. На основе этих экспериментов он восстанавливает, а точнее, угадывает алгоритмы преобразований.

В статическом методе по файлам программного обеспечения восстанавливаются основные элементы исходной программы, которая затем анализируется с целью получения описания собственно алгоритмов защиты. Основным инструментом статического метода служат программы дизассемблирования, восстанавливающие по исполняемым файлам листинги программы на языке ассемблер. Одним из наиболее удачных дизассемблеров в настоящее время считается пакет IDA.

В динамическом методе анализируемая программа запускается под контролем других специализированных программных средств. Наличие этих средств позволяет прогонять программу в пошаговом режиме, останавливать ее работу при осуществлении тех или иных
событий, что значительно облегчает поиск и анализ фрагментов программы, реализующие преобразования, связанные с защитой информации. Основным инструментом динамического метода являются так называемые программы-отладчики. Вместе с тем могут использоваться и другие программные средства.

# Лекция 2
## Особенности анализа некоторых видов программ
Вопросы:
1. Особенности анализа оверлейных программ
2. Особенности анализа графических программ Windows
3. Анализ параллельного кода
4. Особенности анализа кода в режиме ядра
5. Вспомогательные инструменты анализа программ

### 1. Особенности анализа оверлейных программ
Оверлейные программы размещают на памяти только те фрагменты кода, которые выполняются в данный момент.

Проблемы: точки остановок могут быть потеряны, трудности при использовании метода степ-трейс.

Основное решеник: установка точки останова внутри диспетчера оверлея, в этом случае, при удалении любого из сегментов точки останова при последующей подгрузке, восстанавливаются, при исп метода step-and-trace зацикливания не происходит.

### 2. Особенности анализа графических программ Windows
При исп граф. программ после запуска программы формируется её окно, после чего управление опять передаётся в Windows. Для того чтобы применять метод step-and-trace его необходимо модифицировать:
1. Необходимо найти и выбрать точку входа в программу, в которой осуществляется передача управления в интересующую нас функцию, для этого используется драйвер (Spy++ чащу всего).
2. После того как адрес оконной функции получен в него ставится точка останова, при при этом не следует ставить точку останова в начало, поскольку в этом случае любое сообщение в окно будет приводить к остановке
3. После того, как выполнены первые два, запускаем трассировку
Всё вышеперечисленое относится к обычным, недиалоговым окнам.

В случае диалоговых окон, в начале устанавливается точка останова на системную функцию, с помощью которой создаётся соответствующего диалогового окна
После того как адрес диалоговой функции найден, точка останова устанавливается в эту функцию, дальнейшие действия, как с обычными окнами

### 3. Анализ параллельного кода

При анализе параллельного кода важно удалить все точки остановки, чтобы гарантировать анализ единственного потока программы.

• Отладчики могут ставить временные точки остановки, но это не гарантирует корректной работы.

????????????????????

Для того чтобы решить эту проблему неоходимо в начале трассировки удалить все точки остнанова из анализируемой программы, большинство современных программ трассировки позволяют удалённые точки автоматически восстанавливать, т.е. точка удаляется, а информация об этой точке остаётся в отладчике, в последствие она можжет быть восстановлена и использована.

### 4. Особенности анализа кода в режиме ядра
Для анализа кода в режиме ядра используются специальные системные отладчики, такие как "Сайзер". Важно использовать виртуальные машины для запуска отладчика, чтобы избежать возможных проблем с загрузкой операционной системы. При анализе кода в режиме ядра следует избегать использования инструментов, предназначенных для режима пользователя.

Задачи:
1. Задача возникает, если нам требуется проанализировать работу программы, используя драйверы некоторых физических или логических устройств
2. Когда требуется отследить путь передачи информации от процесса клиента к процессу сервера для анализа кода в этом режиме используются системные отладчики. ядром данного отладчика является драйвер, который перехватывает подавляющее большинство функций ядра windows и предоставляет пользователю практически полный контроль над ОС, при этом используются те же функциональные клавиши, что и остальные программы, отслеживаемые системой и это является существенным достоинством, кроме того, на период передачи управления системному драйверу в ОС, приостанавливается системный таймер, т.е. с точки зрения системы этот период исключается из восприятия системы.

При работе с системными драйверами, надо учитывать следующие факторы:
1. Всегда, когда это возможно, запускать их с виртуальной машины. Это позволяет существенно ускорить процессы перезагрузки системы, которых в режиме анализа ядра будет очень много.
2. Применять системный драйвер для анализа кода выполняемого в пользовательском режиме, нужно в крайнем случае и очень осторожно, а если необходимо анализировать и клиентскую программу и работающую из под ядра целесообразно применять два отладчика одновременно
3. Условные точки останова часто работают некорректно, поэтому на это необходимо уделять больше внимания

### 5. Вспомогательные инструменты анализа программ
Вспомогательные программы - как правило, про-раммы-мониторы, отслеживающие те или иные события, протекающие в ОС, за счёт своей специфичности программы-мониторы позволяют быстрее выделить среди всех потоков интересующих:

1. Монитор активных процессов - Proc.MON, имеет следующий функционал: позволяет регистрировать любые обращения к логическим дискам, почтовым ящикам и сетевым ресурсам, регистрировать порождения и завершения процессов загрузки и выгрузки библиотек и драйверов; интенсивность использования аппаратных ресурсов теми или иными процессами и потоками, при этом используется особый режим регистрации указанных событий (детальное описание, список программных модулей, загруженных в адресное пространство и стэк поток на момент регистрации)
2. ProcessExplorer

Лекция 5
